# Slither Insight 101

写于2024年6月13日凌晨2:04
## 写在开头
slither是一个基于ast的solidity静态分析工具，大概从2022年年初开始接触，这比很多大佬晚了很久，花了一年半的时间去做了很多规则的修复，新增，踩了很多坑，当然也有不少个人写规则时的想法，涉及到一些理论，涵盖了一些可能的漏洞理解，权当记录

## 一些结论
首先，说slither有没有用，我个人认为是相当有用的（废话），对于开发者来说，他们可以用slither制定很多特别的规则来检测特别的solidity逻辑

然而，对于那些想要将slither变为公司内部产品的人，你们需要注意两点：
1. slither的许可证是AGPL-V3,这个协议我愿称之为病毒协议，它的特点如下：
    - 必须向用户提供源代码。
    - 对代码的修改必须也开源并使用AGPLv3协议。
    - 代码中必须包含协议和版权声明。
    - 必须记录所做的更改。
    - 用户可以自由使用、修改和共享代码。
    - 放弃质量保证,限制责任。
    - 协议适用于整个程序。
    - 禁止额外的限制。

    而对于AGPL-V3商业使用要求来说：
    1. 必须开源AGPLV3代码修改后的完整源代码。
    2. Network Service即网络服务如果整合了AGPLV3代码,必须对用户提供修改后的完整源代码。
    3. 不能将AGPLV3代码与不兼容许可的代码链接在一起。
    4. 必须继续使用AGPLV3许可发布开源代码。
    5. 必须提供安装信息使用户可以修改和重新编译程序。
    6. 如果违反许可,版权持有人可以终止用户的许可。

简单的说，就是只要你用了它，你就必须开源，我想应该有很多审计公司用它来做成产品，或者作为揽客工具对吧，但你们都没开源，这就很有趣了

2. 如果你要把它作为一个对外的产品，那么它的要求就变的非常高，而slither原版的误报率和漏报率是惨不忍睹的，这也就意味着，你必须要做以下几点：
    -  你需要花大精力去减少误报，你需要花大量的测试用例，尤其必须是实际的合约和安全事件受害合约去跑slither，找到每一个误报的点
    -  你还要对智能合约漏洞，或者说那些真正审计师会concern的漏洞去做深入的分析，了解其通用模型，了解其pattern，这实际上需要高度抽象的理解 

基于以上两点，做slither优化和开发并不是一件简单的事情，这消耗了我大量精力，但却让我在某些漏洞的抽象理解上走了一些距离，我认为这是有效的，也是审计师想要去进步的一个必要的过程

在后面的slither文章中，我会专门逐个介绍每一个我修改的slither规则，阐述其修改原因，insight，以及妥协

是的，这需要妥协，你需要在漏报和误报间做出妥协，如果你的pattern太严格，你的漏报就会高；如果太松，你的误报就会高

## 一些背景
我基于的是slither原版做出的修改，修改后的仓库主要位于https://github.com/MetaTrustLabs/falcon-metatrust，当然也可以关注https://github.com/BradMoonUESTC/slither，不过这里面仅包含了一些核心的规则
